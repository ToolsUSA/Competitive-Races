<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Competitive House & Senate Races</title>
    <script>
        // Haversine formula to calculate the distance between two lat/lng points
        function haversine(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radius of the Earth in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c; // Distance in km
        }

        async function getDistrictByZip() {
            let zip = document.getElementById("zip").value;
            let resultDiv = document.getElementById("result");
            resultDiv.innerHTML = "Checking...";

            // Validate ZIP code
            if (!zip || zip.length !== 5) {
                resultDiv.innerHTML = "Please enter a valid 5-digit ZIP code.";
                return;
            }

            try {
                // Use Geocodio API to get lat/lng for the entered ZIP code
                let response = await fetch(`https://api.geocod.io/v1.7/geocode?q=${zip}&api_key=b373eed4ea9966e2bfee732f4fa433bfe62397a`);
                if (!response.ok) {
                    throw new Error(`Error fetching data: ${response.statusText}`);
                }

                let data = await response.json();
                if (!data.results.length) {
                    resultDiv.innerHTML = "Invalid ZIP code. No data found.";
                    return;
                }

                let lat = data.results[0].location.lat;
                let lon = data.results[0].location.lng;

                // Define competitive races with their lat/lng and other details
                let competitiveRaces = [
                    { district: "AZ 1", lat: 34.5385, lon: -111.4938, margin: 3.8, officeholder: "Rep. Tom O'Halleran (D)" },
                    { district: "CA 13", lat: 37.5956, lon: -120.9578, margin: 0.09, officeholder: "Rep. Adam Gray (D)" },
                    { district: "CA 45", lat: 33.6204, lon: -117.7626, margin: 0.21, officeholder: "Rep. Michelle Steel (R)" },
                    { district: "PA 7", lat: 40.5355, lon: -75.9432, margin: 1.01, officeholder: "Rep. Susan Wild (D)" },
                    // Add more districts here
                ];

                // Find the closest district
                let closestDistrict = null;
                let closestDistance = Infinity;
                competitiveRaces.forEach(race => {
                    let distance = haversine(lat, lon, race.lat, race.lon);
                    if (distance < closestDistance) {
                        closestDistance = distance;
                        closestDistrict = race;
                    }
                });

                // Display results
                if (closestDistrict) {
                    resultDiv.innerHTML = `✅ Your closest competitive district is ${closestDistrict.district} with a margin of ${closestDistrict.margin}%. Current officeholder: ${closestDistrict.officeholder}`;
                } else {
                    resultDiv.innerHTML = "❌ No nearby competitive districts found.";
                }
            } catch (error) {
                resultDiv.innerHTML = `Error: ${error.message}`;
            }
        }
    </script>
</head>
<body>
    <h2>Find Competitive House & Senate Races</h2>
    <p>Enter your ZIP code to check the nearest competitive district:</p>
    <input type="text" id="zip" placeholder="Enter ZIP Code">
    <button onclick="getDistrictByZip()">Check</button>
    <p id="result"></p>
</body>
</html>
